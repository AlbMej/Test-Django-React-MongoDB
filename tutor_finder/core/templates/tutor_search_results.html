<!--
This file displays the tutors for tutor search based
on the filter function
-->

{% extends 'base.html' %}
{% load crispy_forms_tags %}


{% block content %}
    <h1>Search Results</h1>

    {% crispy form %}

    {% if not tutors.len == 0 %}
        <h2>{{ tutors.len }}</h2>
        <ul>
            {% for user in users %}
              {% for tutor in tutors %}
                {% if tutor.user_ID == user.user_ID %}
                  <li>
                    <!-- Each tutor in the list will revieve their own listing -->
                    {{ tutor.name }}, ${{ tutor.price }}/hr, {{tutor.calculate_rating}}
                    <button id="tutor_select" class="btn btn-primary"
                    onClick="reply_click('{{tutor.user_ID}}',
                    '{{user.email_TB}}', '{{user.phone_TB}}',
                    '{{user.other_TB1}}', '{{user.other_TB2}}')">
                    Connect with {{tutor.name}}</button>
                    <button id="rate_select" class="btn btn-warning" onClick="test('{{tutor.pk}}, 4')">Rate {{tutor.name}}</button>
                  </li>
                {% else %}
                  <li>hello!</li>
                {% endif %}
              {% endfor %}
            {% endfor %}
        </ul>
    {% else %}
      <p>Sorry, but no results</p>
    {% endif %}
    <!-- javascript function onclick for connecting with tutor -->
    <!-- Default msg can change in the future, this is placeholder -->
    <script type="text/javascript">
      function reply_click(user_ID, user_info_phone, user_info_email, user_info_other1, user_info_other2)
      {
        if(user_info_other2 == "" || user_info_other2 == null) {
          user_info_other2 = "Option 2: Not provided by " + user_ID
        }

        if(user_info_other1 == "" || user_info_other1 == null) {
          user_info_other1 = "Option 1: Not provided by " + user_ID
        }

        if(user_info_email == "" || user_info_email == null) {
          user_info_email = "email : Not provided by " + user_ID
        }

        if(user_info_phone == "" || user_info_phone == null) {
          user_info_phone = "phone : Not provided by " + user_ID
        }

        var msg = user_ID + ": Contact information\n" + user_info_email + "\n" +
                  user_info_phone + "\n" + user_info_other1 + "\n" + user_info_other2;
        alert(msg);
      }

      function test(pk, rating){
        console.log("hit")
        var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance 
        var theUrl = "/rate";
        xmlhttp.open("POST", theUrl);
        xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xmlhttp.send(JSON.stringify({ "pk": pk, "response": { "rate": rating } }));
      }
    </script>
{% endblock %}
